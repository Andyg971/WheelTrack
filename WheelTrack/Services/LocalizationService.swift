import Foundation
import SwiftUI

/// Service de localisation pour g√©rer le bilinguisme FR/EN dans WheelTrack
class LocalizationService: ObservableObject {
    
    static let shared = LocalizationService()
    
    @AppStorage("app_language") var currentLanguage: String = "fr" {
        didSet {
            objectWillChange.send()
        }
    }
    
    private init() {
        // Observer les changements de langue
        NotificationCenter.default.addObserver(
            self,
            selector: #selector(languageDidChange),
            name: .languageChanged,
            object: nil
        )
    }
    
    @objc private func languageDidChange(_ notification: Notification) {
        if let newLanguage = notification.object as? String {
            currentLanguage = newLanguage
            
            // Note: La synchronisation CloudKit est maintenant g√©r√©e par GeneralSettingsView
            // seulement si l'utilisateur a activ√© l'option iCloud
        }
    }
    
    /// Retourne le texte localis√© selon la langue actuelle
    func text(_ french: String, _ english: String) -> String {
        return currentLanguage == "en" ? english : french
    }
    
    /// M√©thode de commodit√© pour les vues SwiftUI
    func localized(_ french: String, _ english: String) -> String {
        return text(french, english)
    }
}

/// Extension View pour faciliter la localisation dans SwiftUI
extension View {
    func localizedText(_ french: String, _ english: String) -> String {
        return LocalizationService.shared.text(french, english)
    }
}

/// Extension View pour utiliser LocalizationService avec @EnvironmentObject
extension View {
    func localizedText(using localizationService: LocalizationService, _ french: String, _ english: String) -> String {
        return localizationService.text(french, english)
    }
}

/// Dictionnaire de traductions communes
struct CommonTranslations {
    
    // Navigation
    static let back = ("Retour", "Back")
    static let cancel = ("Annuler", "Cancel")
    static let save = ("Enregistrer", "Save")
    static let delete = ("Supprimer", "Delete")
    static let edit = ("Modifier", "Edit")
    static let add = ("Ajouter", "Add")
    static let done = ("Termin√©", "Done")
    static let ok = ("OK", "OK")
    static let close = ("Fermer", "Close")
    
    // Common UI
    static let loading = ("Chargement...", "Loading...")
    static let error = ("Erreur", "Error")
    static let success = ("Succ√®s", "Success")
    static let warning = ("Attention", "Warning")
    static let info = ("Information", "Info")
    
    // WheelTrack specific
    static let appName = ("WheelTrack", "WheelTrack")
    static let vehicles = ("V√©hicules", "Vehicles")
    static let dashboard = ("Tableau de bord", "Dashboard")
    static let expenses = ("D√©penses", "Expenses")
    static let maintenance = ("Maintenance", "Maintenance")
    static let garages = ("Garages", "Garages")
    static let rentals = ("Locations", "Rentals")
    static let settings = ("R√©glages", "Settings")
    static let profile = ("Profil", "Profile")
    
    // Vehicle related
    static let make = ("Marque", "Make")
    static let model = ("Mod√®le", "Model")
    static let year = ("Ann√©e", "Year")
    static let mileage = ("Kilom√©trage", "Mileage")
    static let fuelType = ("Carburant", "Fuel Type")
    static let licensePlate = ("Plaque d'immatriculation", "License Plate")
    static let vin = ("Num√©ro de ch√¢ssis", "VIN")
    static let price = ("Prix", "Price")
    static let status = ("Statut", "Status")
    
    // Expenses
    static let amount = ("Montant", "Amount")
    static let date = ("Date", "Date")
    static let category = ("Cat√©gorie", "Category")
    static let description = ("Description", "Description")
    static let receipt = ("Re√ßu", "Receipt")
    
    // Maintenance
    static let nextMaintenance = ("Prochaine maintenance", "Next Maintenance")
    static let lastMaintenance = ("Derni√®re maintenance", "Last Maintenance")
    static let type = ("Type", "Type")
    static let garage = ("Garage", "Garage")
    static let notes = ("Notes", "Notes")
    
    // Units
    static let km = ("km", "km")
    static let miles = ("miles", "miles")
    static let liters = ("litres", "liters")
    static let gallons = ("gallons", "gallons")
    static let euro = ("‚Ç¨", "‚Ç¨")
    static let dollar = ("$", "$")
    
    // Time
    static let today = ("Aujourd'hui", "Today")
    static let yesterday = ("Hier", "Yesterday")
    static let thisWeek = ("Cette semaine", "This Week")
    static let thisMonth = ("Ce mois", "This Month")
    static let thisYear = ("Cette ann√©e", "This Year")
    
    // Status
    static let active = ("Actif", "Active")
    static let inactive = ("Inactif", "Inactive")
    static let sold = ("Vendu", "Sold")
    static let available = ("Disponible", "Available")
    static let rented = ("Lou√©", "Rented")
    static let maintenance_status = ("En maintenance", "Under Maintenance")
    
    // MARK: - Nouvelles traductions pour corriger les textes hardcod√©s
    
    // Location/G√©olocalisation
    static let locatingInProgress = ("Localisation en cours...", "Locating...")
    static let locationError = ("Erreur de localisation", "Location Error")
    static let locationDisabled = ("Localisation d√©sactiv√©e", "Location Disabled")
    
    // Garage/Services
    static let carGarage = ("Garage automobile", "Car Garage")
    static let informations = ("Informations", "Information")
    static let phone = ("T√©l√©phone :", "Phone:")
    static let services = ("Services :", "Services:")
    static let hours = ("Horaires :", "Hours:")
    static let call = ("Appeler", "Call")
    static let directions = ("Itin√©raire dans Plans", "Directions in Maps")
    static let addToFavorites = ("Ajouter aux favoris", "Add to Favorites")
    static let removeFromFavorites = ("Retirer des favoris", "Remove from Favorites")
    
    // Rental/Location
    static let duration = ("Dur√©e :", "Duration:")
    static let pricePerDay = ("Prix par jour", "Price per day")
    static let totalRental = ("Total de la location", "Total rental")
    static let modifyContract = ("Modifier le contrat", "Modify Contract")
    static let renterInformation = ("Informations du locataire", "Renter Information")
    static let rentalPeriod = ("P√©riode de location", "Rental Period")
    static let pricing = ("Tarification", "Pricing")
    static let startDate = ("Date de d√©but", "Start Date")
    static let endDate = ("Date de fin", "End Date")
    static let renterFullName = ("Nom complet du locataire", "Renter Full Name")
    static let days = ("jour", "day")
    static let daysPlural = ("jours", "days")
    
    // Apple Sign In
    static let connectedWithApple = ("Connect√© avec Apple !", "Connected with Apple!")
    static let connectionError = ("Erreur de connexion", "Connection Error")
    static let signOut = ("Se d√©connecter", "Sign Out")
    static let connectionSuccessful = ("Connexion r√©ussie !", "Connection Successful!")
    
    // Profile/User
    static let profilePhoto = ("Photo de profil", "Profile Photo")
    static let personalInformation = ("Informations personnelles", "Personal Information")
    static let userProfile = ("Profil utilisateur", "User Profile")
    static let editProfile = ("Modifier le profil", "Edit Profile")
    
    // Form elements
    static let validation = ("Validation", "Validation")
    static let saveChanges = ("Sauvegarder", "Save")
    static let formError = ("Erreur de formulaire", "Form Error")
    static let requiredField = ("Champ obligatoire", "Required Field")
    
    // Navigation tabs
    static let finances = ("Finances", "Finances")
    static let vehicleManagement = ("Gestion des v√©hicules", "Vehicle Management")
    static let mainDashboard = ("Tableau de bord principal", "Main Dashboard")
    static let financialTracking = ("Suivi financier", "Financial Tracking")
    static let automotiveServices = ("Services automobiles", "Automotive Services")
    
    // Accessibility
    static let dashboardTab = ("Affiche un aper√ßu de vos v√©hicules et d√©penses", "Shows an overview of your vehicles and expenses")
    static let vehiclesTab = ("G√©rez vos v√©hicules et leur maintenance", "Manage your vehicles and their maintenance")
    static let financesTab = ("Consultez et g√©rez vos d√©penses automobiles", "View and manage your automotive expenses")
    static let servicesTab = ("Acc√©dez aux garages et √† la location de v√©hicules", "Access garages and vehicle rental")
    
    // Dashboard specific
    static let hello = ("Bonjour ! üëã", "Hello! üëã")
    static let overview = ("Voici un aper√ßu de vos d√©penses et locations", "Here's an overview of your expenses and rentals")
    static let period = ("P√©riode", "Period")
    static let totalExpenses = ("Total des d√©penses", "Total expenses")
    static let viewAllExpenses = ("Voir toutes les d√©penses", "View all expenses")
    static let noActiveRental = ("Aucune location active", "No active rental")
    static let actives = ("actives", "active")
    static let recentExpenses = ("Derni√®res d√©penses", "Recent expenses")
    static let noExpenses = ("Aucune d√©pense", "No expenses")
    static let addFirstExpense = ("Commencez par ajouter votre premi√®re d√©pense pour suivre vos finances", "Start by adding your first expense to track your finances")
    static let addExpense = ("Ajouter une d√©pense", "Add expense")
    static let expensesEvolution = ("√âvolution des d√©penses", "Expenses evolution")
    static let noDataToDisplay = ("Aucune donn√©e √† afficher", "No data to display")
    static let revenue = ("revenus", "revenue")
    static let language = ("fr", "en")
    
    // ExpensesView specific
    static let myExpenses = ("Mes D√©penses", "My Expenses")
    static let manageVehicleCosts = ("G√©rez tous vos frais de v√©hicules", "Manage all your vehicle costs")
    static let categoryDistribution = ("R√©partition par cat√©gorie", "Distribution by category")
    static let allExpenses = ("Toutes les d√©penses", "All Expenses")
    static let noExpensesFound = ("Aucune d√©pense trouv√©e", "No expenses found")
    static let expensesWillAppearHere = ("Vos d√©penses appara√Ætront ici.\nAjoutez votre premi√®re d√©pense pour commencer.", "Your expenses will appear here.\nAdd your first expense to get started.")
    static let deleteExpenseTitle = ("Supprimer la d√©pense ?", "Delete expense?")
    static let deleteExpenseAlertMessage = ("Cette action est irr√©versible.", "This action is irreversible.")
    static let unknownVehicle = ("V√©hicule inconnu", "Unknown vehicle")
    static let expense = ("d√©pense", "expense")
    static let categories = ("Cat√©gories", "Categories")
    
    // VehiclesView specific
    static let manageFleet = ("G√©rez votre flotte automobile", "Manage your vehicle fleet")
    static let totalVehicles = ("Total v√©hicules", "Total vehicles")
    static let inRental = ("en location", "in rental")
    static let brandDistribution = ("R√©partition par marque", "Distribution by brand")
    static let searchVehicles = ("Rechercher des v√©hicules", "Search vehicles")
    static let noVehicles = ("Aucun v√©hicule", "No vehicles")
    static let addFirstVehicle = ("Commencez par ajouter votre premier v√©hicule pour suivre votre flotte", "Start by adding your first vehicle to track your fleet")
    static let addVehicle = ("Ajouter un v√©hicule", "Add vehicle")
    static let noFilterMatch = ("Aucun v√©hicule ne correspond √† ce filtre", "No vehicles match this filter")
    static let filters = ("Filtres", "Filters")
    static let all = ("Tous", "All")
    
    // GaragesView specific
    static let myFavorites = ("Mes Favoris", "My Favorites")
    static let myGarages = ("Mes Garages", "My Garages")
    static let locationRequired = ("G√©olocalisation requise", "Location Required")
    static let locationRequiredMessage = ("Pour trouver des garages pr√®s de vous, autorisez l'acc√®s √† votre localisation dans les r√©glages.", "To find garages near you, allow location access in settings.")
    static let later = ("Plus tard", "Later")
    static let nearbyGarages = ("Garages proches", "Nearby Garages")
    static let searchingNearby = ("Recherche de garages proches...", "Searching for nearby garages...")
    static let noGarages = ("Aucun garage", "No garages")
    static let noFavoriteGarages = ("Aucun garage favori", "No favorite garages")
    static let enableLocationMessage = ("Activez la g√©olocalisation pour trouver des garages pr√®s de vous", "Enable location to find garages near you")
    static let enableLocation = ("Activer la g√©olocalisation", "Enable Location")
    static let refresh = ("Rafra√Æchir", "Refresh")
    static let authorize = ("Autoriser", "Allow")
    static let garageFound = ("garage trouv√©", "garage found")
    static let garagesFound = ("garages trouv√©s", "garages found")
    static let profileTab = ("G√©rez vos param√®tres et informations personnelles", "Manage your settings and personal information")
    static let mainNavigation = ("Navigation principale", "Main Navigation")
    static let useTabsToNavigate = ("Utilisez les onglets pour naviguer entre les diff√©rentes sections de l'application", "Use tabs to navigate between different sections of the app")
    static let loadingApplication = ("Chargement de l'application", "Loading application")
    static let pleaseWaitLoading = ("Veuillez patienter pendant le chargement", "Please wait while loading")
    static let loadingScreen = ("√âcran de chargement WheelTrack", "WheelTrack Loading Screen")
    
    // Tabs
    static let vehiclesTabLabel = ("Onglet v√©hicules", "Vehicles tab")
    static let maintenanceTabLabel = ("Onglet maintenance", "Maintenance tab")
    static let showsVehicleList = ("Affiche la liste de vos v√©hicules", "Shows your vehicle list")
    static let manageVehicleMaintenance = ("G√©rez l'entretien de vos v√©hicules", "Manage your vehicle maintenance")
    
    // Additional GaragesView translations
    static let notAvailable = ("Non disponible", "Not available")
    static let favorites = ("Favoris", "Favorites")
    static let otherServices = ("%d autres services", "%d other services")
    static let favoriteGarages = ("garages favoris", "favorite garages")
    static let favoriteGarage = ("garage favori", "favorite garage")
    static let garagesLoadedLocation = ("garages charg√©s depuis votre position", "garages loaded from your location")
    static let inFavorites = ("dans les favoris", "in favorites")
    static let openAppleMaps = ("Ouvrir dans Plans", "Open in Maps")
    static let deleteAllFavorites = ("Supprimer tous les favoris", "Delete all favorites")
    static let showAllGarages = ("Voir tous les garages", "Show all garages")
    static let showOnlyFavorites = ("Afficher seulement les favoris", "Show only favorites")
    static let toggleGaragesFavorites = ("Basculer entre tous les garages et les favoris", "Toggle between all garages and favorites")
    static let noFavoriteGarage = ("Aucun garage favori", "No favorite garage")
    static let addFavoritesMessage = ("Ajoutez vos garages pr√©f√©r√©s pour un acc√®s rapide", "Add your favorite garages for quick access")
    static let viewAllGarages = ("Voir tous les garages", "View all garages")
    static let noGarageFound = ("Aucun garage trouv√©", "No garage found")
    static let locationRequiredEmpty = ("G√©olocalisation requise pour afficher les garages √† proximit√©", "Location required to show nearby garages")
    static let tryRefresh = ("Essayez de rafra√Æchir ou", "Try refreshing or")
    static let authorizeLocation = ("autorisez la g√©olocalisation", "authorize location")
    static let authorizeGeolocation = ("Autoriser la g√©olocalisation", "Authorize geolocation")
    static let authorizeAccess = ("Autorisez l'acc√®s √† votre position pour voir les garages √† proximit√©.", "Authorize access to your location to see nearby garages.")
    static let nearbyGaragesLoaded = ("Garages √† proximit√© charg√©s", "Nearby garages loaded")
    static let basedCurrentLocation = ("Bas√© sur votre position actuelle", "Based on your current location")
    static let address = ("Adresse", "Address")
    
    // UserProfile specific translations
    static let myProfile = ("Mon Profil", "My Profile")
    static let nameNotProvided = ("Nom non renseign√©", "Name not provided")
    static let drivingLicense = ("Permis de conduire", "Driving License")
    static let mainInsurance = ("Assurance principale", "Main Insurance")
    static let professionalInformation = ("Informations professionnelles", "Professional Information")
    static let financialSettings = ("Param√®tres financiers", "Financial Settings")
    static let preferences = ("Pr√©f√©rences", "Preferences")
    
    // MARK: - Tutorial translations
    
    // Tutorial - Page titles
    static let tutorialWelcomeTitle = ("Bienvenue dans WheelTrack", "Welcome to WheelTrack")
    static let tutorialVehiclesTitle = ("G√©rez vos v√©hicules", "Manage your vehicles")
    static let tutorialFinancesTitle = ("Suivez vos finances", "Track your finances")
    static let tutorialCloudTitle = ("Synchronisation CloudKit", "CloudKit Sync")
    
    // Tutorial - Page subtitles
    static let tutorialWelcomeSubtitle = ("Votre assistant personnel pour g√©rer vos v√©hicules et leurs co√ªts", "Your personal assistant for managing your vehicles and their costs")
    static let tutorialVehiclesSubtitle = ("Ajoutez vos v√©hicules, programmez leurs maintenances et suivez leur historique", "Add your vehicles, schedule their maintenance and track their history")
    static let tutorialFinancesSubtitle = ("Analysez vos d√©penses avec des graphiques d√©taill√©s et des statistiques avanc√©es", "Analyze your expenses with detailed charts and advanced statistics")
    static let tutorialCloudSubtitle = ("Vos donn√©es sont automatiquement synchronis√©es sur tous vos appareils Apple", "Your data is automatically synced across all your Apple devices")
    
    // Tutorial - Descriptions
    static let tutorialWelcomeDescription = ("D√©couvrez toutes les fonctionnalit√©s qui vous permettront de ma√Ætriser vos co√ªts automobiles", "Discover all the features that will help you master your automotive costs")
    static let tutorialVehiclesDescription = ("‚Ä¢ Garage virtuel avec photos\n‚Ä¢ Alertes de maintenance\n‚Ä¢ Historique complet\n‚Ä¢ Gestion des contrats", "‚Ä¢ Virtual garage with photos\n‚Ä¢ Maintenance alerts\n‚Ä¢ Complete history\n‚Ä¢ Contract management")
    static let tutorialFinancesDescription = ("‚Ä¢ Cat√©gorisation automatique\n‚Ä¢ Graphiques interactifs\n‚Ä¢ Analyses de tendances\n‚Ä¢ Rapports d√©taill√©s", "‚Ä¢ Automatic categorization\n‚Ä¢ Interactive charts\n‚Ä¢ Trend analysis\n‚Ä¢ Detailed reports")
    static let tutorialCloudDescription = ("‚Ä¢ Sauvegarde automatique\n‚Ä¢ Synchronisation temps r√©el\n‚Ä¢ S√©curit√© Apple\n‚Ä¢ Acc√®s multi-appareils", "‚Ä¢ Automatic backup\n‚Ä¢ Real-time sync\n‚Ä¢ Apple security\n‚Ä¢ Multi-device access")
    
    // Tutorial - Actions
    static let tutorialNext = ("Suivant", "Next")
    static let tutorialSkip = ("Passer", "Skip")
    static let tutorialStart = ("Commencer", "Get Started")
    static let tutorialPrevious = ("Pr√©c√©dent", "Previous")
    
    // Nouveau syst√®me de tutoriel simplifi√© (3 slides)
    static let tutorialPage1Title = ("Gestion de v√©hicules", "Vehicle Management")
    static let tutorialPage1Description = ("Ajoutez vos v√©hicules, suivez leur kilom√©trage et organisez votre garage personnel.", "Add your vehicles, track mileage and organize your personal garage.")
    
    static let tutorialPage2Title = ("Suivi financier", "Financial Tracking")
    static let tutorialPage2Description = ("Enregistrez vos d√©penses automobile et visualisez vos donn√©es avec des graphiques d√©taill√©s.", "Record your automotive expenses and visualize your data with detailed charts.")
    
    static let tutorialPage3Title = ("Synchronisation iCloud", "iCloud Sync")
    static let tutorialPage3Description = ("Vos donn√©es sont automatiquement sauvegard√©es et synchronis√©es sur tous vos appareils Apple.", "Your data is automatically backed up and synced across all your Apple devices.")
    
    // MARK: - Notifications de location
    static let rentalStartsTomorrow = ("Location d√©marre demain", "Rental starts tomorrow")
    static let rentalStartsTomorrowBody = ("r√©cup√®re le v√©hicule demain. Pensez √† le pr√©parer !", "picks up the vehicle tomorrow. Remember to prepare it!")
    static let rentalStartsIn2Hours = ("Location dans 2h", "Rental in 2 hours")
    static let rentalStartsIn2HoursBody = ("arrive bient√¥t pour r√©cup√©rer le v√©hicule", "arrives soon to pick up the vehicle")
    static let rentalEndsTodayTitle = ("üö® Fin de location AUJOURD'HUI", "üö® Rental ends TODAY")
    static let rentalEndsTodayBody = ("doit rendre le v√©hicule aujourd'hui", "must return the vehicle today")
    static let rentalEndsTomorrowTitle = ("Fin de location demain", "Rental ends tomorrow")
    static let rentalEndsTomorrowBody = ("doit rendre le v√©hicule demain", "must return the vehicle tomorrow")
    
    // MARK: - Messages d'erreur et validation
    static let syncError = ("Erreur de synchronisation", "Sync Error")
    static let syncErrorMessage = ("Une erreur est survenue lors de la synchronisation des donn√©es.", "An error occurred while syncing data.")
    static let retry = ("R√©essayer", "Retry")
    static let validationError = ("Erreur de validation", "Validation Error")
    static let requiredFields = ("Veuillez remplir tous les champs obligatoires", "Please fill in all required fields")
    static let invalidAmount = ("Le montant doit √™tre sup√©rieur √† 0", "Amount must be greater than 0")
    static let invalidPrice = ("Le prix doit √™tre sup√©rieur √† 0", "Price must be greater than 0")
    static let invalidYear = ("L'ann√©e doit √™tre entre 1900 et 2030", "Year must be between 1900 and 2030")
    static let invalidMileage = ("Le kilom√©trage doit √™tre positif", "Mileage must be positive")
    static let networkError = ("Erreur r√©seau", "Network Error")
    static let dataError = ("Erreur de donn√©es", "Data Error")
    static let loadingData = ("Chargement des donn√©es...", "Loading data...")
    static let syncingData = ("Synchronisation en cours...", "Syncing data...")
}

/// Helper pour acc√©der facilement aux traductions
func L(_ translation: (String, String)) -> String {
    return LocalizationService.shared.text(translation.0, translation.1)
} 